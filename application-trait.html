<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Application Trait - COSMIC Toolkit</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">COSMIC Toolkit</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-application-trait"><a class="header" href="#the-application-trait">The Application Trait</a></h1>
<h2 id="model"><a class="header" href="#model">Model</a></h2>
<pre><code class="language-rs">use cosmic::prelude::*;

struct App {
    counter: u32,
    counter_text: String,
}
</code></pre>
<p>Every application begins with a model. This will be used as the single source of truth for your entire application and its GUI.
This will include widget labels, text inputs, fetched icons, and any other values that need to be passed or referenced as input parameters when creating elements.
Widgets are stateless, which means that they do not contain application state within themselves, but instead rely on the application model as the source for their state.</p>
<pre><code class="language-rs">use cosmic::prelude::*;

struct App {
    core: cosmic::Core,
    // ...
}
</code></pre>
<p>The cosmic library also has some state of its own that you will need to store in your application model, refferred to as the <a href="https://pop-os.github.io/libcosmic/cosmic/app/struct.Core.html">cosmic::Core</a>. This is managed internally by the cosmic runtime, but can also be used by the application to get and set certain runtime parameters.</p>
<h2 id="message"><a class="header" href="#message">Message</a></h2>
<p>Alongside that struct, there will also be a Message type, which describes the kinds of events that widgets in the applications are going to emit.</p>
<pre><code class="language-rs">#[derive(Debug, Clone)]
pub enum Message {
    Clicked
}
</code></pre>
<h2 id="the-trait"><a class="header" href="#the-trait">The Trait</a></h2>
<p>Together, these will be used to create a <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html">cosmic::Application</a>. Implementing this trait will automatically generate all of the necessary code to run a COSMIC application which integrates consistently within the COSMIC desktop.</p>
<p>Note that the following associated types and constants are required:</p>
<ul>
<li><code>Executor</code> is the async executor that will be used to run your application's commands.</li>
<li><code>Flags</code> is the data that your application needs to use before it starts.</li>
<li><code>Message</code> is the enum that contains all the possible variants that your application will need to transmit messages.</li>
<li><code>APP_ID</code> is the unique identifier of your application.</li>
</ul>
<p>We also need to provide methods to enable the COSMIC app runtime to access the application's Core.</p>
<pre><code class="language-rs">impl cosmic::Application for App {
    type Executor = cosmic::executor::Default;
    type Flags = ();
    type Message = Message;

    const APP_ID: &amp;str = "tld.domain.AppName";

    fn core(&amp;self) -&gt; &amp;Core {
        &amp;self.core
    }

    fn core_mut(&amp;mut self) -&gt; &amp;mut Core {
        &amp;mut self.core
    }
}
</code></pre>
<h2 id="init"><a class="header" href="#init">Init</a></h2>
<p>This is where your application model will be constructed, and any necessary tasks scheduled for execution on init.
This will typically be where you want to set the name of the window title.</p>
<pre><code class="language-rs">fn init(core: Core, _flags: Self::Flags) -&gt; (Self, cosmic::app::Task&lt;Self::Message&gt;) {
    let mut app = App {
        core,
        counter: 0,
        counter_text: String::new(),
    };

    app.counter_text = format!("Clicked {} times", app.counter);

    let command = app.set_window_title("AppName");

    (app, command)
}
</code></pre>
<h2 id="view"><a class="header" href="#view">View</a></h2>
<p>At the beginning of each iteration of the runtime's event loop, the <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html#tymethod.view">view method</a> will be called to create a view which describes the current state of the UI.
The returned state machine defines the layout of the interface, how it is to be drawn, and what messages widgets will emit when triggered by certain UI events.</p>
<pre><code class="language-rs">impl cosmic::Application for App {
    ...

    /// The returned Element has the same lifetime as the model being borrowed.
    fn view(&amp;self) -&gt; Element&lt;Self::Message&gt; {
        let button = widget::button(&amp;self.counter_text)
            .on_press(Message::Clicked);

        widget::container(button)
            .width(iced::Length::Fill)
            .height(iced::Length::Shrink)
            .center_x()
            .center_y()
            .into()
    }
}
</code></pre>
<p>This method will be composed from widget functions that you can get from the <a href="https://pop-os.github.io/libcosmic/cosmic/widget/index.html">cosmic::widget</a> module.
Note that widgets are composed functionally, and therefore they are designed to have their fields set through a <a href="https://rust-unofficial.github.io/patterns/patterns/creational/builder.html">Builder pattern</a>.</p>
<h2 id="update"><a class="header" href="#update">Update</a></h2>
<p>Messages emitted by the view will later be passed through the application's <a href="https://pop-os.github.io/libcosmic/cosmic/app/trait.Application.html#method.update">update method</a>.
This will use Rust's pattern matching to choose a branch to execute, make any changes necessary to the application's model, and may optionally return one or more commands.</p>
<pre><code class="language-rs">impl cosmic::Application for App {
    ...

    fn update(&amp;mut self, message: Self::Message) -&gt; cosmic::app::Task&lt;Self::Message&gt; {
        match message {
            Message::Clicked =&gt; {
                self.counter += 1;
                self.counter_text = format!("Clicked {} times", self.counter);
            }
        }

        Task::none()
    }
}
</code></pre>
<p>Because this method executes in the runtime's event loop, the application will block for the duration that this method is being called.
It is therefore imperative that any application logic executed here should be swift to prevent the user from experiencing an application freeze.
Anything that requires either asynchronous or long execution time should either be returned as a <a href="tasks.html">Task</a>, or placed into a <a href="subscriptions.html">Subscription</a>.</p>
<h2 id="running-the-application"><a class="header" href="#running-the-application">Running the application</a></h2>
<p>Once the trait has been implemented, you can run it from your main function like so:</p>
<pre><code class="language-rs">fn main() -&gt; cosmic::iced::Result {
    let settings = cosmic::app::Settings::default();
    cosmic::app::run::&lt;App&gt;(settings, ())
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="mvu.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="tasks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="mvu.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="tasks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
